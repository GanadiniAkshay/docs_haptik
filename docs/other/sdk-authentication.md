---
title: Haptik Authentication System
---

## Why

For any user to start using Haptik’s services and to be integrated through clients they need to sign up on the Haptik System and go through OTP verification process. This is needed so that we can identify the users and be sure that they are valid ones. 

We later on also developed a **Guest Authentication** system where the user do not need to go through OTP verification flow. However, this flow is restricted and the user cannot use certain channels which need the user to be a verified user(could be through OTP or Client authentication).

Also, sometimes theres is a custom requirement where the user’s needed to be verified through a client's system and our backend performs a verification with the clients backend to mark the user as verified.

To break this down the authentication systems can be broadly classified into one of the following:

1) Guest Authentication
2) OTP Authentication (OTP generation and validation done by Haptik). Mostly used by Haptik apps and available **only on Native Apps**.
3) Third Party Authentication:
   * Here the authentication can be either be through OTP(generated by clients) or any token mechanism.
   * Haptik SDKs take the token(or OTP) and perform a server to server      verification where the client tells us whether the Auth ID & Auth Token   are valid or not.

Inputs that the SDKs take in for the Sign Up or User Verification:

* User Details(Optional):
  * Full Name
  * Email
  * Mobile Number
  * City
* Authentication Related:
    * Auth Type: This helps the backend to perform sign up based on type              specified.
    * Auth ID: Unique identifier. Most of the cases its the mobile number.   
        * Not needed in Guest Authentication
    * Auth Token: A token which is cross verified against the Auth ID.
        * Not needed in Guest Authentication
        * OTP Authentication - Generated OTP. 
        * Third Party - Token generated by clients. Could be OTP as well

## When to Use Which?

* **OTP Authentication:**
    * **Auth Type Value:** `otp`
    * Is used specifically in Haptik Apps.
    * Can be used where the OTP generation and validation flow is expected     from Haptik system.
    Typical Use Case: OTP Verified user’s are required.
* **Guest Authentication:**
    * **Auth Type Value:** `basic`(Native SDK), `guest`(For JS SDK)
    * This can be used when:
        * Less friction is needed for user sign up process.
        * A verification process is not needed. Majorly in JS SDK web          integrations.
    * On the Mobile SDK’s part, this authentication can be used in             conjunction with OTP Authentication or 3rd Party Authentication system,  where the user initially signs up as a Guest User and then performs      verification as and when needed.
    * **Typical Use Case:** Web Integrations of JS SDK for support bots.
* **3rd Party Authentication:**
  * **Auth Type Value:** New key is created for every client. Please ask                            backend for the exact value.
  * This type of authentication is used when clients have their own authentication system and want to integrate that with Haptik’s one and share information across.
  * Typical example is TOI Apps authentication where if the user is already    logged into TOI app, then same details is shared with the Haptik System    with Auth-ID being mobile number and Auth-Token being token generated by   their system.
  * Another example is of IIFL where client passes the user-id and auth        token of their system while signing up the user.
  * **Typical Use Case:** Custom integration with clients to perform client     specific authentication or fetch data(like user details) from their        servers.
  * **For sales / PM / solutioning team:** It’s important to the following     things from client side for custom auth:
      * Client app should share user **auth_id**, **auth_code** and             **auth_type** during user signup with our SDK.
      * Backend API to verify user based on **auth_id** and **auth_code**.



### How to create new 3rd party authentication from backend
There is a base class in backend called  `Authentication` which has the following methods:
* **send_auth_token()**:
    * You can override the above method which will trigger a flow to send the authentication token to user during the sign up flow.
    * Eg: Sending SMS with OTP or trigger email or a push notification etc
* **authenticate()**:
    * Once the SDK makes an actual call for sign up with user details,         auth-id and auth-token, this method does the task of verifying if the    auth-id and auth-token are valid.
    * In case of OTP Authentication, we store the OTP sent in DB and once      this method is called, we cross verify the mobile number(Auth-ID) to     the OTP received(Auth-Token).
    * In case of 3rd Party Authentication, we do a server to server API call,  where we hit the clients server to check if the Auth-ID and the          Auth-Token has valid references with each other(Staging and              Production Env tokens of clients are different from each other).
    * In case of Guest Authentication, we perform nothing.
* **verify_source()**:
    * It is a security check method to ensure integrity of the data received.
    * The Mobile SDK’s hash the parameters using a private key before making   the API call and adds it as a parameter.
    * The server applies the same logic to compute the hash from received      parameters and then compare it with the hash received in the API call.
    * This way we get to know if the data has been tampered or not.
    * This is not performed for JS SDK as of now.
* **post_signup_flow()**:
    * Perform operations which are needed after the sign up is completed.
    * Eg: We cache member details in ClubMahindra flow where we get the        user’s information from the client once the sign up is complete.

If any new client comes in which needs a separate authentication type other than Guest or OTP based functionality, you can do following steps:
1) Create a new file in `app_user.user_authentication` package which extends the `Authentication` class.
2) Override the above methods as per the requirements.
3) Register for dynamic loading in `app_user.const` file.

### Questions:
* What happens if we have 100 clients? Will we have 100 different integration files for each client?
* How will `verify_source()` work when we have client who uses same auth type for JS and mobile SDK. Right now there is a small difference in how it is executes for JS and Mobile SDK’s where mobile SDK’s checks for hash.(Will work based on type of SDK being used)
* Can we create a generic response and request structure for all different clients and ask them to adhere to it, for 3rd party authentication system? 


### Suggestions:
The below code is being used in multiple different files in similar fashion:

```python
for required_param in required_params:
   if self.kwargs.get(required_param) is None:
       data['error'] = required_param + ' is missing from data'
       data['success'] = False
       break
return data
```

We can make a **util** function out of it and use it across different files to reduce code duplicacy.
