<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Integrating Custom Code · Haptik Docs</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="## Node Integrations"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Integrating Custom Code · Haptik Docs"/><meta property="og:type" content="website"/><meta property="og:url" content="https://docs.haptik.ai/"/><meta property="og:description" content="## Node Integrations"/><meta property="og:image" content="https://docs.haptik.ai/img/image_0.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://docs.haptik.ai/img/image_0.png"/><link rel="shortcut icon" href="/img/image_0.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-106563119-6', 'auto');
              ga('send', 'pageview');
            </script><script type="text/javascript" src="/js/index.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/image_0.png" alt="Haptik Docs"/><h2 class="headerTitleWithLogo">Haptik Docs</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li><li class=""><a href="/#tools" target="_self">Tools</a></li><li class=""><a href="/#integrations" target="_self">Integrations</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Advanced</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Getting Started</h3><ul class=""><li class="navListItem"><a class="navItem" href="/bot-builder/basic/introduction">Introduction</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/for-bot-builders">For Bot Builders</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Guides</h3><ul class=""><li class="navListItem"><a class="navItem" href="/bot-builder/basic/making-first-bot">Making Your First Bot</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/design-guidelines">Designing Chat Experiences</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/testing-bot">Testing your bot</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/multiple-languages">Multiple Languages</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/building-voice-bots">Building Voice bots</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/platforms-deployment">Platforms Deployment</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Resources</h3><ul class=""><li class="navListItem"><a class="navItem" href="/bot-builder/basic/bot-hierarchy">Bot Hierarchy</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/business">Business</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/creating-story">Creating a Story</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/editing-smalltalk">Editing Smalltalk</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/story-templates">Story Templates</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/creating-nodes">Creating Nodes</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/connections">Connections</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/general-nodes">General Nodes</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/user-says">User Says</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/bot-says">Bot Says</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/chat-elements">Chat Elements</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/entities">Entities</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/bot-prompt-trigger">Bot Prompt Trigger</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/general-responses">General Responses</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/basic/forms">Forms</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Advanced</h3><ul class=""><li class="navListItem navListItemActive"><a class="navItem" href="/bot-builder/advanced/integrating-custom-code">Integrating Custom Code</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/advanced/integrating-webviews-into-sdk">Integrating Webviews</a></li><li class="navListItem"><a class="navItem" href="/bot-builder/advanced/integrating-with-external-bot">Integrating with External Bot</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Integrating Custom Code</h1></header><article><div><span><h2><a class="anchor" aria-hidden="true" id="node-integrations"></a><a href="#node-integrations" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Node Integrations</h2>
<p>Once a particular node has been detected and the mandatory entities have been collected, these entities can be given to custom code to execute your own business logic.</p>
<p>There are 2 different ways to execute this business logic.</p>
<h3><a class="anchor" aria-hidden="true" id="api-functions"></a><a href="#api-functions" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>API Functions</h3>
<p><em>This is internal to Haptik Developers</em></p>
<h3><a class="anchor" aria-hidden="true" id="webhooks"></a><a href="#webhooks" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Webhooks</h3>
<p>A node can be configured to call a webhook once the required entities have been collected.</p>
<p>To deploy a live webhook that can receive webhook events, your code must be hosted on a public HTTP server that has the following:</p>
<ul>
<li>A Valid SSL Certificate</li>
<li>An open port that accepts <code>GET</code> and <code>POST</code> requests</li>
</ul>
<p>There are two ways to use webhooks to integrate external code in your bot. The two ways are:</p>
<h4><a class="anchor" aria-hidden="true" id="1-relative-urls"></a><a href="#1-relative-urls" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>1. Relative URLs</h4>
<p>In the first method, you can set a common base URL for the bot. And then you can add relative paths in the node where the integration is required. This method allows you to set two base URLs, one for the test environment and one for the production environment.</p>
<p>Having environment specific base URLs allows you to easily test your bot with code from different environments. Also because only the production base URL will be used in production, this helps you avoid issues of accidentally having a production bot linked to non production code.</p>
<p>In your test environment you can configure which environment's base URL to use. However, in production only the production environment's base URL will be used. This is to ensure that the bots in production are only referring to production code.</p>
<h5><a class="anchor" aria-hidden="true" id="setting-up-base-url"></a><a href="#setting-up-base-url" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Setting up base URL</h5>
<p>You can set the environment specific base URLs while creating the bot as shown below.</p>
<ol>
<li>Click on Create Bot</li>
<li>Fill details and scroll down to the <code>Bot deployment environment</code> section.</li>
<li>Enter the environment specific base URLs.</li>
</ol>
<p><img src="/assets/integrating_custom_code_env_base_url_new_bot.png" alt="environment specific base URL for new bots"></p>
<p>For existing bots you can set or update these URLs by using the <code>edit bot</code> option from the top menubar in the bot builder tool.</p>
<p><img src="/assets/integrating_custom_code_env_base_url_edit_bot.gif" alt="environment specific base URL edit bot"></p>
<h5><a class="anchor" aria-hidden="true" id="adding-integration-endpoint"></a><a href="#adding-integration-endpoint" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Adding integration endpoint</h5>
<ol>
<li>Click on node on which you want to add integration function</li>
<li>Select Integration</li>
<li>Select API and put API endpoint like shown in image</li>
</ol>
<p><img src="/assets/integrating_custom_code_endpoint.png" alt="adding integration endpoint"></p>
<p><strong><em>Note</em></strong>: The endpoint uses the environemnt specific base URL of the bot. You can see the URL in the label of the textbox.</p>
<h4><a class="anchor" aria-hidden="true" id="2-override-base-urls-and-use-absolute-urls"></a><a href="#2-override-base-urls-and-use-absolute-urls" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>2. Override base URLs and use absolute URLs</h4>
<p>The second method is to use absolute URLs. There might be times where you want to use an API endpoint on a domain which is different from the base URL. In such cases you can override the base URL as shown below. Just select the override base URL option and enter the full URL including the path in the text box.</p>
<p><img src="/assets/integrating_custom_code_env_override_url.gif" alt="overriding base URL"></p>
<p>Specify the security challenge that will be verified</p>
<p><strong>Request Method</strong></p>
<p>POST</p>
<p><strong>Request Headers</strong></p>
<table>
<thead>
<tr><th>Header</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td>Content-Type</td><td>application/json</td></tr>
<tr><td>X-Hub-Signature</td><td>sha1=signature (The HMAC hex digest of the request body. This header will be sent if the node is configured with a secret. The HMAC hex digest is generated using the sha1 hash function and the secret as the HMAC key.)</td></tr>
</tbody>
</table>
<p><strong>Request Parameters</strong></p>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"node"</span>: <span class="hljs-string">"system name of the node"</span>,
  <span class="hljs-attr">"event"</span>: <span class="hljs-string">"API_INTEGRATION"</span>,
  <span class="hljs-attr">"user"</span>: {
    <span class="hljs-attr">"user_id"</span>: <span class="hljs-string">"User ID"</span>,
    <span class="hljs-attr">"user_name"</span>: <span class="hljs-string">"haptik username"</span>,
    <span class="hljs-attr">"full_name"</span>: <span class="hljs-string">""</span>,
    <span class="hljs-attr">"device_platform"</span>: <span class="hljs-number">5</span>,
    <span class="hljs-attr">"language_code"</span>: <span class="hljs-string">"User's current language"</span>,
    <span class="hljs-attr">"auth_id"</span>: <span class="hljs-string">"Authentication ID, If AuthInfo Is present else empty string"</span>,
    <span class="hljs-attr">"auth_code"</span>: <span class="hljs-string">"Authentication Code, If AuthInfo Is present else empty string"</span>
  },
  <span class="hljs-attr">"conversation_no"</span>: <span class="hljs-number">1</span>,
  <span class="hljs-attr">"entities"</span>: {
    <span class="hljs-attr">"product_id"</span>: [
      {
        <span class="hljs-attr">"detection"</span>: <span class="hljs-string">"message"</span>,
        <span class="hljs-attr">"original_text"</span>: <span class="hljs-string">"71"</span>,
        <span class="hljs-attr">"entity_value"</span>: <span class="hljs-string">"71"</span>
      }
    ],
    <span class="hljs-attr">"email"</span>: [
      {
        <span class="hljs-attr">"detection"</span>: <span class="hljs-string">"user_profile"</span>,
        <span class="hljs-attr">"original_text"</span>: <span class="hljs-string">"test@test.com"</span>,
        <span class="hljs-attr">"entity_value"</span>: <span class="hljs-string">"test@test.com"</span>
      }
    ],
    <span class="hljs-attr">"product_name"</span>: [
      {
        <span class="hljs-attr">"detection"</span>: <span class="hljs-string">"default"</span>,
        <span class="hljs-attr">"original_text"</span>: <span class="hljs-string">"headphones"</span>,
        <span class="hljs-attr">"entity_value"</span>: <span class="hljs-string">"headphones"</span>
      }
    ]
  }
}
</code></pre>
<p><strong>1. node</strong> - Unique system name of the calling node</p>
<blockquote>
<p><strong>Nodes</strong> are the interlinked building blocks of a bot. Each node acts like a gatekeeper who detects user inputs, sends out appropriate responses, and directs users to the next node. They are the points where conversation converges or diverges basis the information users input to the bot. Nodes are comprised of several important sub-components, which house important pieces of information. <a href="https://docs.haptik.ai/bot-builder/basic/creating-nodes#what-is-a-node">Read More</a></p>
</blockquote>
<p><strong>2. entities</strong> - The entities dictionary will have a key for each entity that is detected e.g. movie_name, venue, phone_number, etc. The value for each entity is a list of dictionary as shown below.</p>
<blockquote>
<p><strong>Entities</strong>: An entity represents the set of values from which a user’s response must come in order for that user to progress onwards in a conversation. Depending on the context of the conversation, the required response can either be a single value or limited group of specific values from the entity, or any value from within the entity. Entities are always added in connection with the bot’s query the required response is associated with, so that they may detect whether the required response was given. <a href="https://docs.haptik.ai/bot-builder/basic/entities">Read More</a></p>
</blockquote>
<p><strong>3. event</strong> - event type e.g. API_INTEGRATION</p>
<p><strong>4. user</strong> - Dictionary containing user data</p>
<p><strong>5. conversation_no</strong> - Identifier for the current conversation of the user with this Business</p>
<p><strong>entity output format</strong></p>
<pre><code class="hljs css language-json">[
    {
        <span class="hljs-attr">"entity_value"</span>: entity_value,
        <span class="hljs-attr">"detection"</span>: detection_method,
        <span class="hljs-attr">"original_text"</span>: original_text
    }
]
</code></pre>
<p>Consider the following example for detailed explanation:</p>
<p>&quot;I want to order from mcd&quot;</p>
<ul>
<li>entity_value: This will store the value of entity (i.e entity value) that is detected. For example, Mc’Donalds.</li>
<li>detection: This will store how the entity is detected i.e. whether from message, structured value or fallback value.</li>
<li>original_text: This will store the actual value that is detected. For example, mcd.</li>
</ul>
<p><strong>Response Parameters</strong></p>
<p>A <code>200 OK</code> HTTP Response must be sent back to the Haptik Servers, Failing which a bot break response will be sent to the user. Webhook response must be sent in 30 seconds or less, failing which a bot break response will be sent to the user.
The following additional fields can be specified by the Webhook to control behaviour of the bot and send messages to the user.</p>
<pre><code class="hljs css language-json">{
    <span class="hljs-attr">"response"</span>: [
        <span class="hljs-string">"message1"</span>,
        <span class="hljs-string">"message2"</span>,
        ....
    ],
    <span class="hljs-attr">"status"</span>: True/False,
}
</code></pre>
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td>response</td><td>array</td><td>List of messages to be sent to the user</td></tr>
<tr><td>status</td><td>boolean</td><td>If status is True, then the decorator will assign the response to success_response. If status is False, then the decorator will assign the response to failure_response</td></tr>
</tbody>
</table>
<p><strong>status</strong> - Depending on whether the node is an end node or not, the True/False flag can affect the status of the chat.</p>
<blockquote>
<p>If the node is an <strong>end node</strong> and if the integration response returns <strong>status True</strong>, then the chat will be <strong>moved to complete state.</strong></p>
<p>If the node is an <strong>end node</strong> and if the integration response returns <strong>status False</strong>, then the chat will remain in <strong>Bot state</strong>.</p>
<p>If the node is <strong>not an end node</strong>, then the chat <strong>remains in Bot state</strong> after sending the response irrespective of the status.</p>
</blockquote>
<p><strong>response</strong> -Response will be array of string(s) or hsl(haptik specific language).</p>
<p>for example:</p>
<ol>
<li><p>Response with single line</p>
<pre><code class="hljs css language-python">{
    <span class="hljs-string">"status"</span>: <span class="hljs-literal">True</span>,
    <span class="hljs-string">"response"</span>: [<span class="hljs-string">"phone number seems invalid, please try again"</span>]
}
</code></pre></li>
<li><p>Response with multi-line</p>
<pre><code class="hljs css language-python">{
    <span class="hljs-string">"status"</span>: <span class="hljs-literal">True</span>,
    <span class="hljs-string">"response"</span>: [<span class="hljs-string">"phone number seems invalid"</span>, <span class="hljs-string">"please try again"</span>]
}
</code></pre></li>
<li><p>Response for Multi-Lingual Bot</p>
<pre><code class="hljs css language-python">language_code = request_body[<span class="hljs-string">'user'</span>][<span class="hljs-string">'language_code'</span>] <span class="hljs-comment">#assuming request_body contains post-data</span>
<span class="hljs-keyword">if</span>  language_code == <span class="hljs-string">'en'</span>:
  message = [<span class="hljs-string">"phone number seems invalid, please try again"</span>]
<span class="hljs-keyword">elif</span> language_code == <span class="hljs-string">'hi'</span>:
  message = [<span class="hljs-string">"फ़ोन नंबर अमान्य लगता है, कृपया पुनः प्रयास करें"</span>]
<span class="hljs-keyword">else</span>:
  message = &lt;Any Message <span class="hljs-keyword">as</span> per use case&gt;

{
  <span class="hljs-string">"status"</span>: <span class="hljs-literal">True</span>,
  <span class="hljs-string">"response"</span>: message <span class="hljs-comment"># One we created above from conditional logic^^</span>
}
</code></pre></li>
<li><p>Response with advanced UI elements <a href="https://haptik-docs.readthedocs.io/en/latest/bot-builder-advanced/message-elements.html">for more detail read here</a></p></li>
</ol>
<p><img src="/assets/advanced-ui-element.png" alt="Bot response with advanced UI elements"></p>
<pre><code class="hljs css language-json">  {
    <span class="hljs-attr">"status"</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">"response"</span>: [
      '{
        <span class="hljs-attr">"text"</span>: <span class="hljs-string">"COMPLETE BLOOD COUNT; CBC"</span>,
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"BUTTON"</span>,
        <span class="hljs-attr">"data"</span>: {
          <span class="hljs-attr">"items"</span>: [
            {
              <span class="hljs-attr">"actionable_text"</span>: <span class="hljs-string">"View Price"</span>,
              <span class="hljs-attr">"location_required"</span>: <span class="hljs-literal">false</span>,
              <span class="hljs-attr">"is_default"</span>: <span class="hljs-number">0</span>,
              <span class="hljs-attr">"uri"</span>: <span class="hljs-string">"LAUNCH_CHANNEL"</span>,
              <span class="hljs-attr">"type"</span>: <span class="hljs-string">"TEXT_ONLY"</span>,
              <span class="hljs-attr">"payload"</span>: {
                <span class="hljs-attr">"gogo_message"</span>: <span class="hljs-string">""</span>,
                <span class="hljs-attr">"message"</span>: <span class="hljs-string">"I want to check the price of this test"</span>
              }
            },
            {
              <span class="hljs-attr">"actionable_text"</span>: <span class="hljs-string">"View Details"</span>,
              <span class="hljs-attr">"location_required"</span>: <span class="hljs-literal">false</span>,
              <span class="hljs-attr">"is_default"</span>: <span class="hljs-number">0</span>,
              <span class="hljs-attr">"uri"</span>: <span class="hljs-string">"LINK"</span>,
              <span class="hljs-attr">"type"</span>: <span class="hljs-string">"APP_ACTION"</span>,
              <span class="hljs-attr">"payload"</span>: {
                <span class="hljs-attr">"url"</span>: <span class="hljs-string">"XYZ.COM"</span>,
                <span class="hljs-attr">"gogo_message"</span>: <span class="hljs-string">""</span>
              }
            }
          ]
        },
        <span class="hljs-attr">"isNew"</span>: <span class="hljs-literal">false</span>
      }'
    ]
  }
</code></pre>
<p>As per our pipeline, if there is no response at specific stages, then it will be treated as a Botbreak scenario. So if your Bot Says section on Mogambo doesn't have any response or the integration function doesn't return any response, then a Botbreak message will be sent or the chat will be moved to Pending state depending on whether Human assistance is disabled or enabled respectively.</p>
<blockquote>
<p>So if human_assistance is OFF on business manager =&gt; Botbreak message will be sent.</p>
<p>If human_assistance is ON on business manager =&gt; Chat will be moved to pending and assigned to an agent.</p>
</blockquote>
<p><strong>Validate Webhook</strong></p>
<p>The HTTP request will contain an X-Hub-Signature header which contains the SHA1 signature of the request payload, using the secret_key entered for the node, and prefixed with sha1=. Your API can verify this signature to validate the integrity and origin of the payload.</p>
<p><strong>Sample python code for webhook</strong></p>
<pre><code class="hljs css language-python"><span class="hljs-comment"># !/usr/bin/env python</span>

<span class="hljs-string">"""
Simple HTTP server in python for handling haptik webhooks.

Usage::
./test_server.py [&lt;port&gt;]

"""</span>
<span class="hljs-keyword">import</span> cgi
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> hmac
<span class="hljs-keyword">import</span> hashlib
<span class="hljs-keyword">from</span> BaseHTTPServer <span class="hljs-keyword">import</span> BaseHTTPRequestHandler, HTTPServer


<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebhookServer</span><span class="hljs-params">(BaseHTTPRequestHandler)</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_set_headers</span><span class="hljs-params">(self, status_code, content_type)</span>:</span>
        self.send_response(status_code)
        self.send_header(<span class="hljs-string">'Content-type'</span>, content_type)
        self.end_headers()

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">do_GET</span><span class="hljs-params">(self)</span>:</span>
        self._set_headers(status_code=<span class="hljs-number">200</span>, content_type=<span class="hljs-string">'text/html'</span>)
        self.wfile.write(<span class="hljs-string">"&lt;html&gt;&lt;body&gt;&lt;h1&gt;Test Server&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;"</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">do_POST</span><span class="hljs-params">(self)</span>:</span>
        content_type, pdict = cgi.parse_header(self.headers.getheader(<span class="hljs-string">'Content-Type'</span>))

        <span class="hljs-keyword">if</span> content_type != <span class="hljs-string">'application/json'</span>:
            self.send_response(<span class="hljs-number">400</span>)
            self.end_headers()
            <span class="hljs-keyword">return</span>

        length = int(self.headers.getheader(<span class="hljs-string">'Content-Length'</span>))
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> length:
            self.send_response(<span class="hljs-number">400</span>)
            self.end_headers()
            <span class="hljs-keyword">return</span>

        body = self.rfile.read(length)
        data = json.loads(body)
        secret_key = <span class="hljs-string">'test'</span>
        hash_value = hmac.new(secret_key, body, hashlib.sha1).hexdigest()
        sha1_signature = <span class="hljs-string">'sha1='</span> + str(hash_value)
        request_signature = self.headers.getheader(<span class="hljs-string">'X-Hub-Signature'</span>)
        <span class="hljs-keyword">if</span> sha1_signature != request_signature:
            self.send_response(<span class="hljs-number">401</span>)
            self.end_headers()
            <span class="hljs-keyword">return</span>

        entities = data[<span class="hljs-string">'entities'</span>]
        product_name = entities[<span class="hljs-string">'product_name'</span>][<span class="hljs-number">0</span>][<span class="hljs-string">'entity_value'</span>] <span class="hljs-keyword">if</span> entities.get(<span class="hljs-string">'product_name'</span>) <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span>
        <span class="hljs-keyword">if</span> product_name == <span class="hljs-string">'speaker'</span>:
            message = <span class="hljs-string">'The Wireless Radio Alarm Clock Speaker can be yours only for Rs.1599'</span>
        <span class="hljs-keyword">elif</span> product_name == <span class="hljs-string">'powerbank'</span>:
            message = <span class="hljs-string">'The Ambrane Powerbank can be yours only for Rs.1799'</span>
        <span class="hljs-keyword">else</span>:
            self.send_response(<span class="hljs-number">400</span>)
            self.end_headers()
            <span class="hljs-keyword">return</span>

        response = {<span class="hljs-string">"status"</span>: <span class="hljs-literal">True</span>, <span class="hljs-string">"response"</span>: [message]}
        self._set_headers(status_code=<span class="hljs-number">200</span>, content_type=<span class="hljs-string">'application/json'</span>)
        self.wfile.write(json.dumps(response))

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span><span class="hljs-params">(server_class=HTTPServer, handler_class=WebhookServer, port=<span class="hljs-number">80</span>)</span>:</span>
        server_address = (<span class="hljs-string">''</span>, port)
        httpd = server_class(server_address, handler_class)
        <span class="hljs-keyword">print</span> <span class="hljs-string">'Starting test server...'</span>
        httpd.serve_forever()

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-keyword">from</span> sys <span class="hljs-keyword">import</span> argv
    <span class="hljs-keyword">if</span> len(argv) == <span class="hljs-number">2</span>:
        run(port=int(argv[<span class="hljs-number">1</span>]))
    <span class="hljs-keyword">else</span>:
        run()
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="custom-code"></a><a href="#custom-code" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Custom Code</h3>
<p>A node can also be configured to execute custom code once the required entities have been collected.</p>
<p>To be able to do so, you can use the in-built code editor in Mogambo or paste Python3.6 specific code into the editor and save.</p>
<p>The only requirement is, the code should follow the below format. If any syntax errors or exceptions are raised by the main function, this will result in a botBreak message.</p>
<pre><code class="hljs css language-python"><span class="hljs-keyword">import</span>  json

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-params">(event, context)</span>:</span>
    <span class="hljs-string">"""
    event['body'] is a string dict with the following keys:
    node, event, user, entities.

    Currently, we pass user_id, user_name, full_name, device_platform and language_code in the user dictionary.

    Args:
        event (dict): Data corresponding to this event
        context

    Returns
        (dict): response with statusCode and the response for the User
    """</span>
    body = json.loads(event[<span class="hljs-string">'body'</span>])
    entities = body[<span class="hljs-string">'entities'</span>]
    user_data = body[<span class="hljs-string">'user'</span>]
    final_response = {<span class="hljs-string">'status'</span>: <span class="hljs-literal">True</span>, <span class="hljs-string">'response'</span>: write_here()}
    response = {<span class="hljs-string">'statusCode'</span>: <span class="hljs-number">200</span>, <span class="hljs-string">'body'</span>: json.dumps(final_response), <span class="hljs-string">'headers'</span>: {<span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>}}
    <span class="hljs-keyword">return</span> response

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">write_here</span><span class="hljs-params">(*args)</span>:</span>
    <span class="hljs-string">"""
   WRITE YOUR CODE HERE and update the final_response dict
   """</span>
    <span class="hljs-comment"># hsl_list = ['Hello', {}]</span>
    button_hsl = {
        <span class="hljs-string">"text"</span>: <span class="hljs-string">"COMPLETE BLOOD COUNT; CBC"</span>,
        <span class="hljs-string">"type"</span>: <span class="hljs-string">"BUTTON"</span>,
        <span class="hljs-string">"data"</span>: {
            <span class="hljs-string">"items"</span>: [
                {
                    <span class="hljs-string">"actionable_text"</span>: <span class="hljs-string">"View Price"</span>,
                    <span class="hljs-string">"location_required"</span>: <span class="hljs-literal">False</span>,
                    <span class="hljs-string">"is_default"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"uri"</span>: <span class="hljs-string">"LAUNCH_CHANNEL"</span>,
                    <span class="hljs-string">"type"</span>: <span class="hljs-string">"TEXT_ONLY"</span>,
                    <span class="hljs-string">"payload"</span>: {
                        <span class="hljs-string">"gogo_message"</span>: <span class="hljs-string">""</span>,
                        <span class="hljs-string">"message"</span>: <span class="hljs-string">"I want to check the price of this test"</span>
                    }
                },
                {
                    <span class="hljs-string">"actionable_text"</span>: <span class="hljs-string">"View Details"</span>,
                    <span class="hljs-string">"location_required"</span>: <span class="hljs-literal">False</span>,
                    <span class="hljs-string">"is_default"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"uri"</span>: <span class="hljs-string">"LINK"</span>,
                    <span class="hljs-string">"type"</span>: <span class="hljs-string">"APP_ACTION"</span>,
                    <span class="hljs-string">"payload"</span>: {
                        <span class="hljs-string">"url"</span>: <span class="hljs-string">"XYZ.COM"</span>,
                        <span class="hljs-string">"gogo_message"</span>: <span class="hljs-string">""</span>
                    }
                }
            ]
        },
        <span class="hljs-string">"isNew"</span>: <span class="hljs-literal">False</span>
    }
    <span class="hljs-keyword">return</span> [json.dumps(button_hsl)]

</code></pre>
<h5><a class="anchor" aria-hidden="true" id="supported-packages"></a><a href="#supported-packages" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Supported Packages</h5>
<ol>
<li><em>Default</em> - <a href="https://gist.github.com/gene1wood/4a052f39490fae00e0c3#file-all_aws_lambda_modules_python3-6-txt">List of Packages here</a></li>
<li><em>Extra packages</em> -<br>
chardet-3.0.4
gspread-3.1.0
httplib2-0.13.1
idna-2.8
mysqlclient-1.4.2
oauth2client-4.1.3
pyasn1-0.4.6
pyasn1-modules-0.2.6
pytz-2019.2
redis-3.2.1
requests-2.22.0
rsa-4.0
six-1.12.0
unicodecsv-0.14.1
urllib3-1.25.3</li>
</ol>
<h4><a class="anchor" aria-hidden="true" id="pre-transfer"></a><a href="#pre-transfer" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Pre-Transfer</h4>
<p><code>Train Bot</code> prepares the code for production. Hence, you should make sure to call <code>Train Bot</code> if there are any changes in the custom code integration before transferring the bot to production.</p>
<h2><a class="anchor" aria-hidden="true" id="additional-apis"></a><a href="#additional-apis" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Additional APIs</h2>
<h3><a class="anchor" aria-hidden="true" id="move-a-chat-to-pending"></a><a href="#move-a-chat-to-pending" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Move a chat to pending</h3>
<p>This API allows you to move chats for a Bot to an Agent via a <code>POST</code> request to the Haptik Platform.</p>
<p>Example URL: <code>https://&lt;base-url&gt;/integration/external/v1.0/send_chat_to_agent/</code></p>
<blockquote>
<p>Note: The <code>base-url</code> will be provided by Haptik at the time of integration.</p>
</blockquote>
<h4><a class="anchor" aria-hidden="true" id="headers"></a><a href="#headers" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Headers</h4>
<pre><code class="hljs"><span class="hljs-symbol">Authorization:</span> Bearer <span class="hljs-params">&lt;TOKEN&gt;</span>
client-id: <span class="hljs-params">&lt;CLIENT_ID&gt;</span>
Content-Type: application/json
</code></pre>
<ul>
<li>Authorization - The Authorization header of each HTTP request should be “Bearer” followed by your token which will be provided by Haptik</li>
<li>client-id - The client id for your account which will be provided by Haptik</li>
<li>Content-Type - application/json</li>
</ul>
<h4><a class="anchor" aria-hidden="true" id="request"></a><a href="#request" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Request</h4>
<pre><code class="hljs css language-json">{
    <span class="hljs-attr">"team_name"</span>: <span class="hljs-string">"&lt;Name of the team&gt;"</span>,
    <span class="hljs-attr">"user_name"</span>: <span class="hljs-string">"&lt;haptik user name&gt;"</span>,
    <span class="hljs-attr">"business_id"</span>: &lt;business_id&gt;,
}
</code></pre>
<ul>
<li>user_name (string): Identifier for the User provided by Haptik when invoking the Integration API</li>
<li>business_id (number): This is a numeric identifier for the channel where the User is messaging</li>
<li>team_name (string): Name of the team to which the chat is to be assigned. Can be fetched from the Teams page of Agent Chat Tool.</li>
</ul>
<h4><a class="anchor" aria-hidden="true" id="response"></a><a href="#response" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Response</h4>
<p>A successful request to the API will return a <code>200</code> status code with a JSON response object.</p>
<pre><code class="hljs css language-json">{
    <span class="hljs-attr">"success"</span>: <span class="hljs-literal">true</span>
}
</code></pre>
<ul>
<li>success: Indicates if the API was a success or failure</li>
</ul>
<h4><a class="anchor" aria-hidden="true" id="error-response"></a><a href="#error-response" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Error Response</h4>
<p>If there is any error in the Headers or the Request body, then the Error message will be returned in a JSON as shown below:</p>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"error_message"</span>: <span class="hljs-string">"user is not registered"</span>
}
</code></pre>
<p>Here is a list of some possible error messages</p>
<table>
<thead>
<tr><th>Error Message</th><th>Details</th></tr>
</thead>
<tbody>
<tr><td>client_id missing in headers</td><td>client-id is not passed in the Headers of the request</td></tr>
<tr><td>invalid client_id in headers</td><td>Incorrect client-id is passed in the headers</td></tr>
<tr><td>invalid authorization in headers</td><td>The Authorization header is not correct</td></tr>
<tr><td>token missing in headers</td><td>The Authorization token is not provided</td></tr>
<tr><td>invalid token provided</td><td>The Authorization token provided is incorrect</td></tr>
<tr><td>user_name missing in the request</td><td>The user_name is not provided in the request body</td></tr>
<tr><td>business_id missing in the request</td><td>The business_id is not provided in the request body</td></tr>
<tr><td>team_name missing in the request</td><td>The team_name is not provided in the request body</td></tr>
<tr><td>invalid user_name</td><td>The user_name provided is not valid for the Partner</td></tr>
<tr><td>invalid business_id provided</td><td>The business_id provided is not valid for the Partner</td></tr>
<tr><td>business &quot;&lt;business_id&gt;&quot; is inactive</td><td>The business is inactive for the Partner</td></tr>
<tr><td>invalid team_name provided</td><td>The team_name is not valid for the Partner</td></tr>
<tr><td>team &quot;&lt;team_name&gt;&quot; is inactive</td><td>The associated Team is inactive</td></tr>
<tr><td>user has not sent a message</td><td>The user has not had any chat on that Business</td></tr>
</tbody>
</table>
<h4><a class="anchor" aria-hidden="true" id="sample-curl-command"></a><a href="#sample-curl-command" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Sample CURL command</h4>
<pre><code class="hljs">curl -X POST \
    https:<span class="hljs-regexp">//</span>&lt;base-url&gt;<span class="hljs-regexp">/integration/</span>external<span class="hljs-regexp">/v1.0/</span>send_chat_to_agent<span class="hljs-regexp">/ \
  -H 'Authorization: Bearer &lt;TOKEN&gt;' \
  -H 'client-id: &lt;CLIENT_ID&gt;' \
  -H 'Content-Type: application/</span>json<span class="hljs-string">' \
  -d '</span>{
    <span class="hljs-string">"team_name"</span>: <span class="hljs-string">"&lt;Name of the team&gt;"</span>,
    <span class="hljs-string">"user_name"</span>: <span class="hljs-string">"&lt;haptik user name&gt;"</span>,
    <span class="hljs-string">"business_id"</span>: &lt;business_id&gt;
}
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="get-chat-history"></a><a href="#get-chat-history" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Get Chat History</h3>
<p>This API allows you to get the chat history of the user for a conversation via a <code>GET</code> request to the Haptik Platform.</p>
<p>Example URL: <code>https://&lt;base-url&gt;/integration/external/v1.0/get_chat_history/</code></p>
<blockquote>
<p>Note: The <code>base-url</code> will be provided by Haptik at the time of integration.</p>
</blockquote>
<h4><a class="anchor" aria-hidden="true" id="headers-1"></a><a href="#headers-1" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Headers</h4>
<pre><code class="hljs"><span class="hljs-symbol">Authorization:</span> Bearer <span class="hljs-params">&lt;TOKEN&gt;</span>
client-id: <span class="hljs-params">&lt;CLIENT_ID&gt;</span>
Content-Type: application/json
</code></pre>
<ul>
<li>Authorization - The Authorization header of each HTTP request should be “Bearer” followed by your token which will be provided by Haptik</li>
<li>client-id - The client id for your account which will be provided by Haptik</li>
<li>Content-Type - application/json</li>
</ul>
<h4><a class="anchor" aria-hidden="true" id="request-params"></a><a href="#request-params" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Request Params</h4>
<pre><code class="hljs"><span class="hljs-string">"conversation_no"</span>: <span class="hljs-string">"&lt;Conversation no of the chat for the user&gt;"</span>,
<span class="hljs-string">"user_name"</span>: <span class="hljs-string">"&lt;haptik user name&gt;"</span>,
<span class="hljs-string">"business_id"</span>: &lt;business_id&gt;,
<span class="hljs-string">"limit"</span>: <span class="hljs-string">"&lt;number of messages&gt;"</span>(<span class="hljs-keyword">optional</span>)
<span class="hljs-string">"respose_type"</span>: <span class="hljs-string">"&lt;response_type&gt;"</span>(<span class="hljs-keyword">optional</span>)
</code></pre>
<p>Note: Supported response types are <code>json</code> and <code>text</code>. The default response type is <code>json</code>.</p>
<h4><a class="anchor" aria-hidden="true" id="response-1"></a><a href="#response-1" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Response</h4>
<p>A successful request to the API will return a <code>200</code> status code with a default JSON response object containing chat data.</p>
<pre><code class="hljs css language-json">{  
  <span class="hljs-attr">"chat_json"</span>: [
        {
            <span class="hljs-attr">"text"</span>: <span class="hljs-string">"Search places to visit{task}"</span>,
            <span class="hljs-attr">"sender"</span>: <span class="hljs-string">"user"</span>,
            <span class="hljs-attr">"message_id"</span>: <span class="hljs-number">1742</span>
        },
        {
            <span class="hljs-attr">"text"</span>: <span class="hljs-string">"TEXT"</span>,
            <span class="hljs-attr">"sender"</span>: <span class="hljs-string">"bot"</span>,
            <span class="hljs-attr">"message_id"</span>: <span class="hljs-number">1743</span>
        }
    ]
}
</code></pre>
<p>Text type response</p>
<pre><code class="hljs">{  
  <span class="hljs-attr">"chat_text"</span>: <span class="hljs-string">"user: Search places to visit{task}\nbot: TEXT\n"</span>
}

</code></pre>
<ul>
<li>success: Indicates if the API was a success or failure</li>
<li>sender values:
<code>bot</code>: message is sent by the bot
<code>user</code>: message is sent by the user
<code>agent(&lt;AGENT_NAME&gt;)</code>: message is sent by the agent &lt;AGENT_NAME&gt; : name of the agent who sent the message</li>
</ul>
<h4><a class="anchor" aria-hidden="true" id="error-response-1"></a><a href="#error-response-1" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Error Response</h4>
<p>If there is any error in the Headers or the Request body, then the Error message will be returned in a JSON as shown below:</p>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"error_message"</span>: <span class="hljs-string">"user has not sent a message"</span>
}
</code></pre>
<p>Here is a list of some possible error messages</p>
<table>
<thead>
<tr><th>Error Message</th><th>Details</th></tr>
</thead>
<tbody>
<tr><td>invalid client_id</td><td>Incorrect client-id is passed in the headers</td></tr>
<tr><td>invalid token</td><td>The Authorization token provided is incorrect</td></tr>
<tr><td>user_name missing</td><td>The user_name is not provided in the request params</td></tr>
<tr><td>business_id missing</td><td>The business_id is not provided in the request params</td></tr>
<tr><td>conversation_no missing</td><td>The conversation_no is not provided in the request params</td></tr>
<tr><td>invalid user_name</td><td>The user_name provided is not valid for the Partner</td></tr>
<tr><td>user has not sent a message</td><td>The user has not had any chat on that Business</td></tr>
</tbody>
</table>
<h4><a class="anchor" aria-hidden="true" id="sample-curl-command-1"></a><a href="#sample-curl-command-1" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Sample CURL command</h4>
<pre><code class="hljs">curl -<span class="hljs-keyword">X</span> POST \
  http<span class="hljs-variable">s:</span>//<span class="hljs-symbol">&lt;base-url&gt;</span>/integration/external/v1.<span class="hljs-number">0</span>/get_chat_history/?user_name=<span class="hljs-symbol">&lt;user_name&gt;</span>
  &amp;conversation_no=<span class="hljs-symbol">&lt;conversation_no&gt;</span>&amp;business_id=<span class="hljs-symbol">&lt;business_id&gt;</span>&amp;limit=<span class="hljs-symbol">&lt;limit&gt;</span> \
  -H <span class="hljs-string">'Authorization: Bearer &lt;TOKEN&gt;'</span> \
  -H <span class="hljs-string">'client-id: &lt;CLIENT_ID&gt;'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
}
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="best-practices"></a><a href="#best-practices" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Best Practices</h2>
<p><strong>1. Assign Chat to Agent</strong> In some scenarios, where integration response fails or some unknown exception occurs then instead of sending bot break message we can also directly assign chat to an agent for better user experience. <Coming Soon></p>
<p><strong>2.Handle textual content</strong> - Everytime we want to change bot's response, a code change is required. To avoid that pain, we can use <strong>key value stores</strong>. Any person with zero to little tech knowledge can change bot response from key value store (with GUI) by updating the message copy corresponding to that unique message key or ID. This message key can be shared with the developer and fetch the response using that key.</p>
<p><strong>3. HSLs</strong>  - Haptik defines a superset of UI elements that are available across multiple platforms. These UI elements are then converted to their platform equivalent (js-sdk, android, ios, facebook-messenger, etc..) if they are not available on that specific platform. Eg. Forms are converted to quick replies on the Facebook platform and collected over free form. <a href="https://docs.haptik.ai/hsl/">for more detail read here</a></p>
</span></div></article></div><div class="docLastUpdate"><em>Last updated on 2019-9-23</em></div><div class="docs-prevnext"><a class="docs-prev button" href="/bot-builder/basic/forms"><span class="arrow-prev">← </span><span>Forms</span></a><a class="docs-next button" href="/bot-builder/advanced/integrating-webviews-into-sdk"><span>Integrating Webviews</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#node-integrations">Node Integrations</a><ul class="toc-headings"><li><a href="#api-functions">API Functions</a></li><li><a href="#webhooks">Webhooks</a></li><li><a href="#custom-code">Custom Code</a></li></ul></li><li><a href="#additional-apis">Additional APIs</a><ul class="toc-headings"><li><a href="#move-a-chat-to-pending">Move a chat to pending</a></li><li><a href="#get-chat-history">Get Chat History</a></li></ul></li><li><a href="#best-practices">Best Practices</a></li></ul></nav></div><footer class="nav-footer" id="footer"><div class="footer"><a href="https://haptik.ai/" target="_blank" rel="noreferrer noopener" class="fbOpenSource"><img src="/img/image_0.png" alt="Haptik Inc." width="100"/></a><div class="footer-columns"><div class="footer-column"><div class="footer-column-title">Tools</div><div class="footer-column-links"><a href="https://docs.haptik.ai/bot-builder/basic/introduction" class="footer-column-link">Bot Builder</a><a href="https://docs.haptik.ai/agent-chat/" class="footer-column-link">Agent Chat</a><a href="https://docs.haptik.ai/bot-analytics/" class="footer-column-link">Analytics</a></div></div><div class="footer-column"><div class="footer-column-title">Integrations</div><div class="footer-column-links"><a href="https://hellohaptik.github.io/haptik-ios-framework" class="footer-column-link">iOS SDK</a><a href="https://hellohaptik.github.io/haptik-android-lib" class="footer-column-link">Android SDK</a><a href="https://hellohaptik.github.io/javascript_sdk" class="footer-column-link">Web SDK</a><a href="https://docs.haptik.ai/webhooks/" class="footer-column-link">Webhooks</a><a href="https://docs.haptik.ai/hsl/" class="footer-column-link">HSL</a></div></div><div class="footer-column"><div class="footer-column-title">Others</div><div class="footer-column-links"><a href="https://docs.haptik.ai/contributing/index" class="footer-column-link">Contributing</a><a href="https://docs.haptik.ai/other/security" class="footer-column-link">Security</a><a href="https://forms.gle/Z2SowBSFpWLayXQz9" class="footer-column-link">Support</a><a href="https://docs.haptik.ai/other/sla" class="footer-column-link">SLA</a></div></div></div><div class="footer-copyright"></div></div><section class="copyright">Copyright © 2019 Haptik Inc.</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '224c7079e67e84a978d8b4621f6af16d',
                indexName: 'haptik',
                inputSelector: '#search_input_react',
                algoliaOptions: {}
              });
            </script></body></html>